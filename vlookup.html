<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<head>
    <title>VLOOKUP</title>
</head>

<body>
    <textarea cols="30" rows="10" id="input_table1" placeholder="Ievadi pirmo tabulu"></textarea>
    <textarea cols="30" rows="10" id="input_table2" placeholder="Ievadi otro tabulu"></textarea>
    <textarea cols="30" rows="10" id="parameters" placeholder="Ievadied parameteru"></textarea>
    <button onclick="tables();" id="input_table1" id="input_table2" id="parameters">Izveido tabulas</button>

    <table class="table">
        <tr class="table_info">
            <th>Name</th>
            <th>Surname</th>
            <th>Person code</th>
            <th>Salary</th>
        </tr>
        <tbody id="my_table"></tbody>
    </table>

    <script type="text/javascript" language="javascript">

        function tables() {
            let input_table1 = JSON.parse(document.getElementById("input_table1").value);

            let input_table2 = JSON.parse(document.getElementById("input_table2").value);

            parameters = document.getElementById("parameters").value;

            function all_employees_salary(table1, table2, parameters) {

                let table1_array = table1.map(table1_code => {
                    let table2_array = table2.find(table2_code => table2_code[parameters] === table1_code[parameters])
                    return { ...table1_code, ...table2_array }
                })

                let table2_array = table2.map(table2_code => {
                    let table1_array = table1.find(table1_code => table1_code[parameters] === table2_code[parameters])
                    return { ...table2_code, ...table1_array }
                })

                let employees_salary = table2_array.concat(table1_array)

                let filtered_employees_salary = [...new Map(employees_salary.map(dup => [dup[parameters], dup])).values()]

                output(filtered_employees_salary)

            }

            function output(table1) {
                var table = document.getElementById("my_table")

                for (var i = 0; i < table1.length; i++) {
                    var row = `<tr>
                                    <td>${table1[i].name}</td>
                                    <td>${table1[i].surname}</td>
                                    <td>${table1[i].person_codecode}</td>
                                    <td>${table1[i].salary}</td>
                              </tr>`
                    table.innerHTML += row
                }
                
                console.log(table1)
            }

            all_employees_salary(input_table1, input_table2, parameters)

        }

    </script>
</body>